<html>
<head>
<title>Advertisements for YouTube go bye-bye</title>
<!--[if IE]>
<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
<script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>

<script type="text/javascript">
(function ($) { // encapsulate

    // declare in global scope
    window.AdlessTube = {};

    // private methods
    var ytVidId = function (url) {
        if (url !== undefined) {
            var p = /^(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?(?=.*v=((\w|-){11}))(?:\S+)?$/;
            url = (url.match(p)) ? RegExp.$1 : false;
	} else {
            url = undefined;
        }
        return url;
    },
    makeVidSrc = function () {
        if (AdlessTube.onpopstate()) {
            var url = AdlessTube.onpopstate().url;
            if (ytVidId(url)) {
                url = 'http://www.youtube.com/embed/' + ytVidId(url);
            } else {
                url = 'bad';
            }  
        }
        return url;
    };

    // public methods
    AdlessTube.ifValidURL = function(url) {
        if (ytVidId(url) !== false) {
            $('.yt-info').addClass('fieldok').removeClass('fieldnotok').text('Valid URL');
        } else {
            $('.yt-info').removeClass('fieldok');
        }
    };
    AdlessTube.invalidURL = function($el) {
        $el.addClass('fieldnotok');
        $el.text('Not a YouTube URL');
    };

    AdlessTube.onpopstate = function () {
        var match,
            urlParams,
            urlParams = {},
            pl = /\+/g, // Regex for replacing addition symbol with a space
            search = /([^&=]+)=?([^&]*)/g,
            decode = function (s) {
                return decodeURIComponent(s.replace(pl, " "));
            },
            query = window.location.search.substring(1);

        while (match = search.exec(query)) {
            urlParams[decode(match[1])] = decode(match[2]);
        }
        urlParams = (Object.getOwnPropertyNames(urlParams).length > 0) ? urlParams : false;
        return urlParams;
    };
    AdlessTube.addVidSrc = function ($el1, $el2) {
        var vidSrc = makeVidSrc();
        if (vidSrc && vidSrc !== 'bad') {
            $el1.attr('src', vidSrc);
        } else if (vidSrc !== 'bad') {
            AdlessTube.handleInput($('.youtube'));
        } else {
            console.log('not a valid source');
        }
    };
    AdlessTube.handleInput = function ($el) {
        $el.parent().show();

        $(document).keypress(function(e) {
            if( e.which == 13 && ytVidId($el.val()) ) {
                var newURLString = window.location.href + 
                    "?url=" + $el.val();
                window.location.href = newURLString; 
            } else if (e.which == 13 && !ytVidId($el.val()) ) {
                AdlessTube.invalidURL($('.yt-info'));
            }
        });

    };
}(jQuery));

window.onload = function () {
    $('.youtube').bind("change keyup input", function () {
        var url = $(this).val();
        AdlessTube.ifValidURL(url);
    });
    AdlessTube.addVidSrc($('iframe'));
};
</script>
<style type="text/css">
html,body           {height:100%;}
.wrapper            {width:80%;height:100%;margin:0 auto;background:#CCC}
.needinputyn        {display:none;}
.yt-info            {display:none}
.yt-info.fieldok    {display:block;color:green;}
.yt-info.fieldnotok {display:block;color:red;}
.h_iframe           {position:relative;}
.h_iframe .ratio    {display:block;width:100%;height:auto;}
.h_iframe iframe    {position:absolute;top:0;left:0;width:100%; height:100%;}
</style>
<body>
<div class="wrapper">
    <div class="needinputyn">
        	<h1>Remove those damned ads NOW!</h1>
Enter a YouTube URL here:
        <BR>
        <input type="text" class="youtube" value="" />
        <div class="yt-info">Valid URL</div>
        <br />
    </div>
    <div class="h_iframe">
        <!-- a transparent image is preferable -->
        <img class="ratio" src="http://placehold.it/16x9" />
        <iframe src="" frameborder="0" allowfullscreen></iframe>
    </div>
    <p>The video resizes with your browser.</p>
</div>
</body>
</html>
